<!doctype html>

<html>

<head>
    <title>Tutorial 1: Getting Started</title>
    <script src="cytoscape.min.js"></script>
    <script src="test.js"></script>
</head>

<style>
    #cy {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 110px;
        left: 0px
        ;
    }
</style>

<body>
    
    <div id="settings">
    <form>
    <table border=1>
    <tr>
    <td><label for="cellcompcheck">Display interactors by matching cellular component</label></td>
    <td><input id="cellcompcheck" name="cellcompcheck" type="CHECKBOX" value="1" onchange="cellcompfilter(this);"/></td>
    </tr>
    <tr>
    <td><label for="bioproccheck">Display interactors by matching biological process</label></td>
    <td><input id="bioproccheck" name="bioproccheck" type="CHECKBOX" value="1" onchange="bioprocfilter(this);"/></td>
    </tr>
    <tr>
    <td><label for="molfunccheck">Display interactors by matching molecular function</label></td>
    <td><input id="molfunccheck" name="molfunccheck" type="CHECKBOX" value="1" onchange="molfuncfilter(this);"/></td>
    </tr>
    </table>
    <button type="button" id="UpdateNetwork" onclick="RunFilters(this)">Update Network</button>
    
    </form>
    </div>
    
    <div id="cy">
    
    </div>
    <script>
      var cy = cytoscape({
  container: document.getElementById('cy'),
  elements: PPI,
  layout:{
                name:'circle',
            },
    style: [
    {
        selector: 'node',
        style: {
            shape: 'circle',
            'background-color': 'green',
            'text-wrap': 'wrap',
            label: 'data(name)',
            'font-size': '13px'
        }
        
    }]      
});
    cy.nodes()[0].style({shape: 'pentagon', 'background-color': 'red'})
    cy.center(cy.nodes()[0])
    cy.fit();
    
    var filters = []; 
    
    
    for (x=1; x < cy.nodes().length; x++){
            intersectionMF = cy.nodes()[x].data("molfunclist").filter(value => -1 !== querymolfunclist.indexOf(value));
            intersectionBP = cy.nodes()[x].data("bioproclist").filter(value => -1 !== querybioproclist.indexOf(value));
            intersectionCC = cy.nodes()[x].data("cellcomplist").filter(value => -1 !== querycellcomplist.indexOf(value));
            
            if (intersectionMF.length == 0){
            cy.nodes()[x].addClass('rejectMF');} 
            
            else if (intersectionMF.length != 0){
            cy.nodes()[x].data("commonMF", intersectionMF.toString());}
            
            if (intersectionBP.length == 0){
            cy.nodes()[x].addClass('rejectBP');} 
            
            else if (intersectionBP.length != 0){
            cy.nodes()[x].data("commonBP", intersectionBP.toString());}
            
            if (intersectionCC.length == 0){
            cy.nodes()[x].addClass('rejectCC');} 
            
            else if (intersectionCC.length != 0){
            cy.nodes()[x].data("commonCC", intersectionCC);}
            }; 
      
    
    function molfuncfilter(molfunccheck){
    if (molfunccheck.checked){
            filters.push('.rejectMF')}
    else {
    filters.splice(filters.indexOf('.rejectMF'), 1);}}
    
    
    function bioprocfilter(bioproccheck){
    if (bioproccheck.checked){   
            filters.push('.rejectBP')}
    else {
    filters.splice(filters.indexOf('.rejectBP'), 1);}}
    
    
    function cellcompfilter(cellcompcheck){
    if (cellcompcheck.checked){
            filters.push('.rejectCC')}
    else {
    filters.splice(filters.indexOf('.rejectCC'), 1);}}

    
    cy.on("taphold", "node", function(){window.open("https://www.uniprot.org/uniprot/"+this.data("id"));});
    
    cy.nodes().on("cxttap", function(n){
        var node = n.target
         alert('Shared cellular component:  ' + node.data("commonCC") + '\n\n' + 
         'Shared biological process:  ' + node.data("commonBP") + '\n\n' + 'Shared molecular function:  ' + node.data("commonMF"))})
    
    
    
    function RunFilters(UpdateNetwork){
    cy.nodes().style({display: 'element'});

    for (i=0; i < filters.length; i++){
    cy.$(filters[i]).style({display:'none'})}
    
    for (z=1; z < cy.nodes().length; z++){
    if (cy.nodes()[z].connectedEdges(':visible').length == 0){
    cy.nodes()[z].style({display:'none'})}}
    }
    </script>
</body>
</html>