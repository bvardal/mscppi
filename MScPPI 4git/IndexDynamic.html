<!doctype html>

<html>

<head>
    <title>Tutorial 1: Getting Started</title>
    <script src="jquery-3.3.1.min.js"></script>
    <script src="cytoscape.min.js"></script>
    <script src="test.js"></script>
    <link href="cytoscape-context-menus.css" rel="stylesheet" type="text/css" />
    <script src="cytoscape-cose-bilkent.js"></script>
    <script src="cytoscape-context-menus.js"></script>
    
    
</head>

<style>
    #cy {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 110px;
        left: 0px
        ;
    }
</style>

<body>
    
    <div id="settings">
    <form>
    <table border=1>
    <tr>
    <td><label for="cellcompcheck">Display interactors by matching cellular component</label></td>
    <td><input id="cellcompcheck" name="cellcompcheck" type="CHECKBOX" value="1" onchange="cellcompfilter(this);"/></td>
    </tr>
    <tr>
    <td><label for="bioproccheck">Display interactors by matching biological process</label></td>
    <td><input id="bioproccheck" name="bioproccheck" type="CHECKBOX" value="1" onchange="bioprocfilter(this);"/></td>
    </tr>
    <tr>
    <td><label for="molfunccheck">Display interactors by matching molecular function</label></td>
    <td><input id="molfunccheck" name="molfunccheck" type="CHECKBOX" value="1" onchange="molfuncfilter(this);"/></td>
    </tr>
    </table>
    
    </form>
    </div>
    
    <div id="cy">
    
    </div>
    <script>
      var cy = cytoscape({
  container: document.getElementById('cy'),
  elements: PPI,
  layout:{
                name:'cose-bilkent',
                fit: true,
                padding: 200,
                nodeDimensionsIncludeLabels: true,
            },
    style: [
    {
        selector: 'node',
        style: {
            shape: 'circle',
            'background-color': 'green',
            'text-wrap': 'wrap',
            label: 'data(name)',
            'font-size': '13px'
        }
        
    }]      
});
    cy.nodes()[0].style({shape: 'pentagon', 'background-color': 'red'})
    cy.center(cy.nodes()[0])
    
    
    
    for (x=1; x < cy.nodes().length; x++){
            intersectionMF = cy.nodes()[x].data("molfunclist").filter(value => -1 !== querymolfunclist.indexOf(value));
            intersectionBP = cy.nodes()[x].data("bioproclist").filter(value => -1 !== querybioproclist.indexOf(value));
            intersectionCC = cy.nodes()[x].data("cellcomplist").filter(value => -1 !== querycellcomplist.indexOf(value));
            
            if (intersectionMF.length == 0){
            cy.nodes()[x].addClass('rejectMF');} 
            else if (intersectionMF.length != 0){
            cy.nodes()[x].data("commonMF", intersectionMF.toString());}
            if (intersectionBP.length == 0){
            cy.nodes()[x].addClass('rejectBP');} 
            else if (intersectionBP.length != 0){
            cy.nodes()[x].data("commonBP", intersectionBP.toString());}
            if (intersectionCC.length == 0){
            cy.nodes()[x].addClass('rejectCC');} 
            else if (intersectionCC.length != 0){
            cy.nodes()[x].data("commonCC", intersectionCC);}
            }; 
      
      
      var checkevents = [];
      
      
      
      function MFremove(){
             cy.$('.rejectMF').style({display: 'none'});
             for (y=0; y < cy.nodes('.rejectMF').successors().nodes(':visible').length; y++){
                    if (cy.nodes('.rejectMF').successors().nodes(':visible')[y].connectedEdges(':visible').length == 0) {
                    cy.nodes('.rejectMF').successors().nodes(':visible')[y].addClass('rejectspareMF')}}
                    cy.$('.rejectspareMF').style({display:'none'})}
           
            
         
         
      function BPremove(){
            cy.$('.rejectBP').style({display: 'none'});
             for (y=0; y < cy.nodes('.rejectBP').successors().nodes(':visible').length; y++){
                    if (cy.nodes('.rejectBP').successors().nodes(':visible')[y].connectedEdges(':visible').length == 0) {
                    cy.nodes('.rejectBP').successors().nodes(':visible')[y].addClass('rejectspareBP')}}
                    cy.$('.rejectspareBP').style({display:'none'})}
             
             
             
      function CCremove(){
        cy.$('.rejectCC').style({display: 'none'});
                 for (y=0; y < cy.nodes('.rejectCC').successors().nodes(':visible').length; y++){
                        if (cy.nodes('.rejectCC').successors().nodes(':visible')[y].connectedEdges(':visible').length == 0) {
                        cy.nodes('.rejectCC').successors().nodes(':visible')[y].addClass('rejectspareCC')}}
                        cy.$('.rejectspareCC').style({display:'none'})}
 
                 
                 
                 
                 
    function molfuncfilter(molfunccheck){
        
    if (molfunccheck.checked){
         checkevents.push(MFremove)
         MFremove();}
    else {
        checkevents.splice(checkevents.indexOf(MFremove), 1);
        cy.$('.rejectspareMF').removeClass('rejectspareMF');
        cy.nodes().style({display:'element'});
     
        if (checkevents.length != 0){
            for (z=0; z < checkevents.length; z++) {
            checkevents[z]();}}}}
            
    
    
    function bioprocfilter(bioproccheck){
    
    if (bioproccheck.checked){
         checkevents.push(BPremove)
         BPremove()}
    else {
        checkevents.splice(checkevents.indexOf(BPremove), 1);
        cy.$('.rejectspareBP').removeClass('rejectspareBP');
        cy.nodes().style({display:'element'});
        if (checkevents.length != 0){
            for (z=0; z < checkevents.length; z++) {
            checkevents[z]();}}}}
    
    
    
    function cellcompfilter(cellcompcheck){
    
    if (cellcompcheck.checked){
         checkevents.push(CCremove)
         CCremove();}
    else {
        checkevents.splice(checkevents.indexOf(CCremove), 1);
        cy.$('.rejectspareCC').removeClass('rejectspareCC');
        cy.nodes().style({display:'element'});
     
        if (checkevents.length != 0){
            for (z=0; z < checkevents.length; z++) {
            checkevents[z]();}}}}
    
         
    var contextMenu = cy.contextMenus({
                                    menuItems: [
                                        {
                                            id: 'link',
                                            content: 'Link to Uniprot page',
                                            selector: 'node',
                                            onClickFunction: function (event) {
                                              var target = event.target || event.cyTarget;
                                              window.open("https://www.uniprot.org/uniprot/"+target.data("id"));
											  
                                              
                                            },
                                            hasTrailingDivider: true
                                          },
                                          {
                                            id: 'GOshared',
                                            content: 'Show Gene Ontology features shared with query',
                                            selector: 'node',
                                            onClickFunction: function (event) {
                                              var target = event.target || event.cyTarget;
                                              alert('\n\nShared cellular component:  ' + target.data("commonCC") + '\n\n\n' + 
                                             'Shared biological process:  ' + target.data("commonBP") + '\n\n\n' + 'Shared molecular function:  ' + target.data("commonMF"))
                                            },
                                            hasTrailingDivider: true
                                          },
                                          {
                                            id: 'Diseaseinvolement',
                                            content: 'Show disease involvement shared with query',
                                            selector: 'node',
                                            onClickFunction: function (event) {
                                              var target = event.target || event.cyTarget;
                                              
                                            },
                                            hasTrailingDivider: true
                                          },
                                          {
                                            id: 'Structure',
                                            content: 'Show protein 3D structure',
                                            selector: 'node',
                                            onClickFunction: function (event) {
                                              var target = event.target || event.cyTarget;
                                              
                                            },
                                            hasTrailingDivider: true
                                          }
        
    
    ]});
    </script>
</body>
</html>