<!doctype html>

<html>

<head>
    <title>Tutorial 1: Getting Started</title>
    <script src="cytoscape.min.js"></script>
    <script src="test.js"></script>
</head>

<style>
    #cy {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 110px;
        left: 0px
        ;
    }
</style>

<body>
    
    <div id="settings">
    <form>
    <table border=1>
    <tr>
    <td><label for="cellcompcheck">Display interactors by matching cellular component</label></td>
    <td><input id="cellcompcheck" name="cellcompcheck" type="CHECKBOX" value="1" onchange="cellcompfilter(this);"/></td>
    </tr>
    <tr>
    <td><label for="bioproccheck">Display interactors by matching biological process</label></td>
    <td><input id="bioproccheck" name="bioproccheck" type="CHECKBOX" value="1" onchange="bioprocfilter(this);"/></td>
    </tr>
    <tr>
    <td><label for="molfunccheck">Display interactors by matching molecular function</label></td>
    <td><input id="molfunccheck" name="molfunccheck" type="CHECKBOX" value="1" onchange="molfuncfilter(this);"/></td>
    </tr>
    </table>
    
    </form>
    </div>
    
    <div id="cy">
    
    </div>
    <script>
      var cy = cytoscape({
  container: document.getElementById('cy'),
  elements: PPI,
  layout:{
                name:'circle',
            },
    style: [
    {
        selector: 'node',
        style: {
            shape: 'circle',
            'background-color': 'green',
            'text-wrap': 'wrap',
            label: 'data(name)',
            'font-size': '13px'
        }
        
    }]      
});
    cy.nodes()[0].style({shape: 'pentagon', 'background-color': 'red'})
    cy.center(cy.nodes()[0])
    
    
    
    for (x=1; x < cy.nodes().length; x++){
            intersectionMF = cy.nodes()[x].data("molfunclist").filter(value => -1 !== querymolfunclist.indexOf(value));
            intersectionBP = cy.nodes()[x].data("bioproclist").filter(value => -1 !== querybioproclist.indexOf(value));
            intersectionCC = cy.nodes()[x].data("cellcomplist").filter(value => -1 !== querycellcomplist.indexOf(value));
            
            if (intersectionMF.length == 0){
            cy.nodes()[x].addClass('rejectMF');} 
            else if (intersectionMF.length != 0){
            cy.nodes()[x].data("commonMF", intersectionMF.toString());}
            if (intersectionBP.length == 0){
            cy.nodes()[x].addClass('rejectBP');} 
            else if (intersectionBP.length != 0){
            cy.nodes()[x].data("commonBP", intersectionBP.toString());}
            if (intersectionCC.length == 0){
            cy.nodes()[x].addClass('rejectCC');} 
            else if (intersectionCC.length != 0){
            cy.nodes()[x].data("commonCC", intersectionCC);}
            }; 
      
      
      var checkevents = [];
      var restorationlabels = [];
      
      
    function molfuncfilter(molfunccheck){
    
    if (molfunccheck.checked){
    
         checkevents.push('.rejectallMF')
         console.log(checkevents[0])
         restorationlabels.push('.rejectspareMF')
         cy.$('.rejectMF').style({display: 'none'});
         for (y=0; y < cy.nodes('.rejectMF').successors().nodes(':visible').length; y++){
                if (cy.nodes('.rejectMF').successors().nodes(':visible')[y].connectedEdges(':visible').length == 0) {
                cy.nodes('.rejectMF').successors().nodes(':visible')[y].addClass('rejectspareMF')}}
         cy.nodes('.rejectMF').successors().nodes('.rejectspareMF').style({display: 'none'});
         var molfuncdata = cy.$('.rejectMF').union(cy.nodes('.rejectMF').successors().nodes('.rejectspareMF'));
         molfuncdata.addClass('rejectallMF')}
    else {
        checkevents.splice(checkevents.indexOf('.rejectallMF'), 1);
        restorationlabels.splice(restorationlabels.indexOf('.rejectspareMF'), 1);
        var restored = cy.collection();
        
        if (checkevents.length == 2){
        restored = cy.$('.rejectallMF').difference(cy.$(checkevents[0]).union(cy.$(checkevents[1])))
        restored.style({display:'element'})
        
        
        for (y=0; y < restorationlabels.length; y++){
            for (r=0; r < cy.$(restorationlabels[y]).length; r++) {
            if (cy.$(restorationlabels[y])[r].connectedEdges().connectedNodes(':visible').length != 0){
            cy.$(restorationlabels[y])[r].style({display: 'element'})}}}
            cy.$('.rejectspareMF').removeClass('rejectspareMF');
            cy.$('.rejectallMF').removeClass('rejectallMF');
            
        for (j=1; j < cy.nodes().length; j++){
        if (cy.nodes()[j].connectedEdges(':visible').length == 0){
        cy.nodes()[j].style({display:'none'})}}}
            
        else if (checkevents.length == 1){restored = cy.$('.rejectallMF').difference(cy.$(checkevents[0]))
        restored.style({display:'element'})
        for (y=0; y < restorationlabels.length; y++){
            for (r=0; r < cy.$(restorationlabels[y]).length; r++) {
            if (cy.$(restorationlabels[y])[r].connectedEdges().connectedNodes(':visible').length != 0){
            cy.$(restorationlabels[y])[r].style({display: 'element'})}}}
            cy.$('.rejectspareMF').removeClass('rejectspareMF');
            cy.$('.rejectallMF').removeClass('rejectallMF');
            
        for (j=1; j < cy.nodes().length; j++){
        if (cy.nodes()[j].connectedEdges(':visible').length == 0){
        cy.nodes()[j].style({display:'none'})}}}
        
        else if (checkevents.length == 0){
            cy.$('.rejectallMF').style({display: 'element'})
            cy.$('.rejectspareMF').removeClass('rejectspareMF');
            cy.$('.rejectallMF').removeClass('rejectallMF');
            }}}
    
    
    function bioprocfilter(bioproccheck){
    
    if (bioproccheck.checked){
    
         checkevents.push('.rejectallBP')
         console.log(checkevents[0])
         restorationlabels.push('.rejectspareBP')
         cy.$('.rejectBP').style({display: 'none'});
         for (y=0; y < cy.nodes('.rejectBP').successors().nodes(':visible').length; y++){
                if (cy.nodes('.rejectBP').successors().nodes(':visible')[y].connectedEdges(':visible').length == 0) {
                cy.nodes('.rejectBP').successors().nodes(':visible')[y].addClass('rejectspareBP')}}
         cy.nodes('.rejectBP').successors().nodes('.rejectspareBP').style({display: 'none'});
         var bioprocdata = cy.$('.rejectBP').union(cy.nodes('.rejectBP').successors().nodes('.rejectspareBP'));
         bioprocdata.addClass('rejectallBP')}
    else {
        checkevents.splice(checkevents.indexOf('.rejectallBP'), 1);
        restorationlabels.splice(restorationlabels.indexOf('.rejectspareBP'), 1);
        var restored = cy.collection();
        
        if (checkevents.length == 2){
        restored = cy.$('.rejectallBP').difference(cy.$(checkevents[0]).union(cy.$(checkevents[1])))
        restored.style({display:'element'})
        
        for (y=0; y < restorationlabels.length; y++){
            for (r=0; r < cy.$(restorationlabels[y]).length; r++) {
            if (cy.$(restorationlabels[y])[r].connectedEdges().connectedNodes(':visible').length != 0){
            cy.$(restorationlabels[y])[r].style({display: 'element'})}}}
            cy.$('.rejectspareBP').removeClass('rejectspareBP');
            cy.$('.rejectallBP').removeClass('rejectallBP');
            
        for (j=1; j < cy.nodes().length; j++){
        if (cy.nodes()[j].connectedEdges(':visible').length == 0){
        cy.nodes()[j].style({display:'none'})}}}
            
        else if (checkevents.length == 1){restored = cy.$('.rejectallBP').difference(cy.$(checkevents[0]))
        restored.style({display:'element'})
        for (y=0; y < restorationlabels.length; y++){
            for (r=0; r < cy.$(restorationlabels[y]).length; r++) {
            if (cy.$(restorationlabels[y])[r].connectedEdges().connectedNodes(':visible').length != 0){
            cy.$(restorationlabels[y])[r].style({display: 'element'})}}}
            cy.$('.rejectspareBP').removeClass('rejectspareBP');
            cy.$('.rejectallBP').removeClass('rejectallBP');
            
        for (j=1; j < cy.nodes().length; j++){
        if (cy.nodes()[j].connectedEdges(':visible').length == 0){
        cy.nodes()[j].style({display:'none'})}}}
        
        else if (checkevents.length == 0) {
        cy.$('.rejectallBP').style({display: 'element'})
        cy.$('.rejectspareBP').removeClass('rejectspareBP');
        cy.$('.rejectallBP').removeClass('rejectallBP');
        }}}
    
    
    function cellcompfilter(cellcompcheck){
    
    if (cellcompcheck.checked){
    
         checkevents.push('.rejectallCC')
         restorationlabels.push('.rejectspareCC')
         cy.$('.rejectCC').style({display: 'none'});
         for (y=0; y < cy.nodes('.rejectCC').successors().nodes(':visible').length; y++){
                if (cy.nodes('.rejectCC').successors().nodes(':visible')[y].connectedEdges(':visible').length == 0) {
                cy.nodes('.rejectCC').successors().nodes(':visible')[y].addClass('rejectspareCC')}}
         cy.nodes('.rejectCC').successors().nodes('.rejectspareCC').style({display: 'none'});
         var cellcompdata = cy.$('.rejectCC').union(cy.nodes('.rejectCC').successors().nodes('.rejectspareCC'));
         cellcompdata.addClass('rejectallCC');}
    else {
        checkevents.splice(checkevents.indexOf('.rejectallCC'), 1);
        restorationlabels.splice(restorationlabels.indexOf('.rejectspareCC'), 1);
        var restored = cy.collection();
        
        if (checkevents.length == 2){
        restored = cy.$('.rejectallCC').difference(cy.$(checkevents[0]).union(cy.$(checkevents[1])))
        restored.style({display:'element'})
        
        for (y=0; y < restorationlabels.length; y++){
            for (r=0; r < cy.$(restorationlabels[y]).length; r++) {
            if (cy.$(restorationlabels[y])[r].connectedEdges().connectedNodes(':visible').length != 0){
            cy.$(restorationlabels[y])[r].style({display: 'element'})}}}
            cy.$('.rejectspareCC').removeClass('rejectspareCC');
            cy.$('.rejectallCC').removeClass('rejectallCC');
            
        for (j=1; j < cy.nodes().length; j++){
        if (cy.nodes()[j].connectedEdges(':visible').length == 0){
        cy.nodes()[j].style({display:'none'})}}}
            
        else if (checkevents.length == 1){restored = cy.$('.rejectallCC').difference(cy.$(checkevents[0]))
        restored.style({display:'element'})
        for (y=0; y < restorationlabels.length; y++){
            for (r=0; r < cy.$(restorationlabels[y]).length; r++) {
            if (cy.$(restorationlabels[y])[r].connectedEdges().connectedNodes(':visible').length != 0){
            cy.$(restorationlabels[y])[r].style({display: 'element'})}}}
            cy.$('.rejectspareCC').removeClass('rejectspareCC');
            cy.$('.rejectallCC').removeClass('rejectallCC');
            
            
        for (j=1; j < cy.nodes().length; j++){
        if (cy.nodes()[j].connectedEdges(':visible').length == 0){
        cy.nodes()[j].style({display:'none'})}}}
        
        else if (checkevents.length == 0){
        cy.nodes().style({display: 'element'});
        cy.$('.rejectspareCC').removeClass('rejectspareCC');
        cy.$('.rejectallCC').removeClass('rejectallCC');
        }}}
    

    
    cy.on("taphold", "node", function(){window.open("https://www.uniprot.org/uniprot/"+this.data("id"));});
    
    cy.nodes().on("cxttap", function(n){
        var node = n.target
         alert('Shared cellular component:  ' + node.data("commonCC") + '\n\n' + 
         'Shared biological process:  ' + node.data("commonBP") + '\n\n' + 'Shared molecular function:  ' + node.data("commonMF"))})
    
    </script>
</body>
</html>